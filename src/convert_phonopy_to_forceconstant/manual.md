author: Olle Hellman
display: none
graph: none
propname: convert phonopy
propnamelink: <a href="../program/convert_phonopy_to_forceconstant.html">convert phonopy</a>
{!man/convert_phonopy_to_forceconstant.md!}

### Longer summary

This is a utility to convert files generated by [phonopy](https://atztogo.github.io/phonopy) to the TDEP format. Only tested with phonopy version 1.13, older versions will not work.

The resulting phonons might not necessarily agree to 100%, since the treatment I use for the long-ranged polar corrections differ from that in phonopy. The files that are needed are

* unitcell used in phonopy
* supercell used in phonopy (generally `SPOSCAR`)
* `FORCE_CONSTANTS` file, generated by phonopy
* `BORN` file, if applicable

See the phonopy [manual](https://atztogo.github.io/phonopy) for instructions how to generate them. Below is an example snippet that converts forceconstants to the TDEP format.

```bash
#!/bin/bash

# Run phonopy to build the supercell.
phonopy -c POSCAR-unitcell phonopy.conf -d
# Run phonopy to write the forceconstants file
if [ -f "BORN" ]
then
    phonopy -c POSCAR-unitcell phonopy.conf --writefc --nac
else
    phonopy -c POSCAR-unitcell phonopy.conf --writefc
fi

# And finally convert the forceconstant
convert_phonopy_to_forceconstant -fc FORCE_CONSTANTS -fb BORN -fuc POSCAR-unitcell -fss SPOSCAR
```

You might notice at the end, there is a report of how much the proper symmetry is violated. Ideally, it should be zero, but because of how phonopy is constructed, I can not enforce all the symmetries without severly affecting the dispersions.

A tiny caveat: it seems the file formats produced by phonopy oscillate rapidly between versions, so use this tool with caution.
